{% extends "base_dashboard.html" %}

{% block title %}AI Tool Dashboard{% endblock %}

{% block content %}
<!-- Main Content -->
<div class="container">
    <h1 class="text-center text-white mb-4">AI USDOT Lookup Tool From Images!</h1>
        <div class="card p-4 shadow-sm">
            <h4>
                <i class="bi bi-cloud-arrow-up" style="color:#4f8cff"></i>
                Upload to scan your truck images
            </h4>
            <form id="upload-form" enctype="multipart/form-data">
                <div class="mb-3">
                    <input type="file" id="file-input" class="form-control" name="files" multiple accept="image/*">
                </div>
                <button type="submit" class="btn btn-primary">
                    <i class="bi bi-upload"></i> Upload
                </button>
            </form>
        </div>
    <div id="status" style="margin-top: 20px;"></div>
    {% if result_texts %}
    <div class="card mt-4 p-4 shadow-sm">
        <h4>Extracted Texts:</h4>
        {% for text in result_texts %}
        <textarea class="form-control mb-3" rows="5" readonly>{{ text }}</textarea>
        {% endfor %}
    </div>
    {% endif %}

    {% if usdots %}
    <div class="alert alert-success mt-4">
        <h5>DOT Numbers Found!</h5>
        <ul>
            {% for dot in usdots %}
            <li>{{ dot }}</li>
            {% endfor %}
        </ul>
    </div>
    {% endif %}

    <!-- Table Results section -->
    <div class="card mt-4 p-4 shadow-sm">

        <h4>USDOT Number Records</h4>

        <!-- Table filters -->
        <form id="filter-form" class="mb-4" data-dashboard-type="{{ dashboard_type }}">
            <div class="row">
                <div class="col-lg-3 col-md-6 mb-3">
                    <label for="usdot" class="form-label">USDOT Number</label>
                    <input type="text" id="usdot" name="usdot" class="form-control" placeholder="Enter USDOT number">
                </div>
                <div class="col-lg-3 col-md-6 mb-3">
                    <label for="sf_sync_status" class="form-label">Salesforce Sync Status</label>
                    <select id="sf_sync_status" name="sf_sync_status" class="form-select">
                        <option value="">All</option>
                        <option value="SUCCESS">Synced</option>
                        <option value="FAILED">Failed</option>
                        <option value="not_synced">Not Synced</option>
                    </select>
                </div>
                <div class="col-lg-3 col-md-6 mb-3">
                    <label for="sort_by" class="form-label">Sort By</label>
                    <select id="sort_by" name="sort_by" class="form-select">
                        <option value="created_at">Created Date</option>
                        <option value="usdot">USDOT</option>
                        <option value="legal_name">Legal Name</option>
                        <option value="phone">Phone Number</option>
                        <option value="sf_sync_status">Salesforce Sync Status</option>
                    </select>
                </div>
                <div class="col-lg-3 col-md-6 mb-3">
                    <label for="sort_order" class="form-label">Sort Order</label>
                    <select id="sort_order" name="sort_order" class="form-select">
                        <option value="desc">Descending</option>
                        <option value="asc">Ascending</option>
                    </select>
                </div>
            </div>
            <div class="d-flex flex-wrap gap-2">
                <button type="submit" class="btn btn-primary">
                    <i class="bi bi-funnel"></i> Apply Filters
                </button>
                <button type="button" id="reset-sorting" class="btn btn-outline-secondary">
                    <i class="bi bi-arrow-clockwise"></i> Reset Sorting
                </button>
            </div>
        </form>

        <!-- Table Results dynamically loaded using js -->
        <div id="scrollable-container" class="table-responsive" style="height: 500px; overflow-y: auto;">
            <table class="table table-bordered table-hover">
                <thead>
                    <tr>
                        <th>Select</th>
                        <th>DOT Number</th>
                        <th>Legal Name</th>
                        <th>Phone Number</th>
                        <th>Mailing Address</th>
                        <th>Created At</th>
                        <th>Client Contacted</th>
                        <th>Client Followed Up</th>
                        <th>Follow Up By Date</th>
                        <th>Carrier Interested</th>
                        <th>Salesforce Sync Status</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Rows will be dynamically loaded here -->
                </tbody>
            </table>
        </div>
        <div class="d-flex justify-content-end mt-3">
            <a href="/data/export/carriers" class="btn btn-outline-success me-2">
                <i class="bi bi-download"></i>
            </a>
            <button id="revert-button" class="btn btn-secondary me-2" disabled>Revert</button>
            <button id="submit-button" class="btn btn-primary me-2" disabled>Submit</button>
            <button id="sync-to-salesforce" class="btn btn-success me-3">
                <i class="bi bi-cloud-arrow-up"></i> CRM Sync
            </button>
        </div>
    </div>



</div>

{% endblock %}

{% block js_scripts %}
<script src="https://cdn.jsdelivr.net/npm/heic2any/dist/heic2any.min.js"></script>
<script type="module" src="/static/update_carrier_engagement.js"></script>
<script type="module" src="/static/upload.js"></script>
{% endblock %}