{% extends "base_dashboard.html" %}

{% block title %}AI Tool Dashboard{% endblock %}

{% block content %}
<!-- Main Content -->
<div class="container">
    <h1 class="text-center text-white mb-4">AI USDOT Lookup Tool From Images!</h1>
        <div class="card p-4 shadow-sm">
            <h4>
                <i class="bi bi-cloud-arrow-up" style="color:#4f8cff"></i>
                USDOT Lookup Tool
            </h4>
            
            <!-- Tab Navigation -->
            <ul class="nav nav-tabs mb-3" id="uploadTabs" role="tablist">
                <li class="nav-item" role="presentation">
                    <button class="nav-link active" id="image-tab" data-bs-toggle="tab" data-bs-target="#image-upload" type="button" role="tab" aria-controls="image-upload" aria-selected="true">
                        <i class="bi bi-camera"></i> Upload Images
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="manual-tab" data-bs-toggle="tab" data-bs-target="#manual-input" type="button" role="tab" aria-controls="manual-input" aria-selected="false">
                        <i class="bi bi-keyboard"></i> Manual Input
                    </button>
                </li>
            </ul>
            
            <!-- Tab Content -->
            <div class="tab-content" id="uploadTabContent">
                <!-- Image Upload Tab -->
                <div class="tab-pane fade show active" id="image-upload" role="tabpanel" aria-labelledby="image-tab">
                    <p class="text-muted mb-3">Upload truck images to get USDOTs with AI</p>
                    <form id="upload-form" enctype="multipart/form-data">
                        <div class="mb-3">
                            <input type="file" id="file-input" class="form-control" name="files" multiple accept="image/*">
                        </div>
                        <button type="submit" class="btn btn-primary">
                            <i class="bi bi-upload"></i> Upload & Process
                        </button>
                    </form>
                </div>
                
                <!-- Manual Input Tab -->
                <div class="tab-pane fade" id="manual-input" role="tabpanel" aria-labelledby="manual-tab">
                    <form id="manual-form">
                        <div class="mb-3">
                            <label for="usdot-input" class="form-label">USDOT Numbers</label>
                            <textarea id="usdot-input" class="form-control" name="usdot_numbers" rows="4" 
                                      placeholder="Enter USDOT numbers separated by commas, e.g., 123456, 789012, 345678. Invalid numbers will be ignored."></textarea>
                        </div>
                        <button type="submit" class="btn btn-primary">
                            <i class="bi bi-search"></i> Lookup & Process
                        </button>
                    </form>
                </div>
            </div>
        </div>
    <div id="status" style="margin-top: 20px;"></div>


    <!-- Table Results section -->
    <div class="card mt-4 p-4 shadow-sm">

        <h4>USDOT Number Records</h4>

        <!-- Table filters -->
        <form id="filter-form" class="mb-4 row g-3" data-dashboard-type="{{ dashboard_type }}">
            <div class="col-12 col-md-4">
            <input type="text" id="usdot_filter" name="usdot_filter" class="form-control" placeholder="USDOT Number">
            </div>
            <div class="col-12 col-md-5">
            <select id="crm_sync_status" name="crm_sync_status" class="form-select">
                <option value="">All CRM Sync Status</option>
                <option value="SUCCESS">Success</option>
                <option value="FAILED">Failed</option>
                <option value="PENDING">Pending</option>
            </select>
            </div>
            <div class="col-12 col-md-3">
            <button type="submit" class="btn btn-primary w-100">Apply Filters</button>
            </div>
        </form>

        <!-- Table Results dynamically loaded using js -->
        <div id="scrollable-container" class="table-responsive" style="height: 500px; overflow-y: auto;">
            <table class="table table-bordered table-hover">
                <thead>
                    <tr>
                        <th>Select</th>
                        <th>DOT Number</th>
                        <th>Legal Name</th>
                        <th>Phone Number</th>
                        <th>Mailing Address</th>
                        <th>Created At</th>
                        <th>CRM Sync Status</th>
                        <th>CRM Record ID</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Rows will be dynamically loaded here -->
                </tbody>
            </table>
        </div>
        <div class="d-flex justify-content-end mt-3">
            <a href="/data/export/carriers" class="btn btn-outline-success me-2">
                <i class="bi bi-download"></i>
            </a>
            <button id="sync-to-salesforce" class="btn btn-success me-3">
                <i class="bi bi-cloud-arrow-up"></i> CRM Sync
            </button>
        </div>
    </div>



</div>

{% endblock %}

{% block js_scripts %}
<script src="https://cdn.jsdelivr.net/npm/heic2any/dist/heic2any.min.js"></script>
<script type="module" src="/static/update_carrier_engagement.js"></script>
<script type="module" src="/static/upload.js"></script>
{% endblock %}